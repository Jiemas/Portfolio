@page "/"
@using System.Text.Json
@inject DatabaseService DbService
@inject ExpandedStates ExpandedStates

<AnchorLink Typo="Typo.h5" Color="Color.Primary" Href="start" Class="skip-link">Skip to main content</AnchorLink>

<Header Links="headers"/>

<HeroImage />

<MudPaper Elevation="0" Class="mt-5"/>

<MudPaper Elevation="0" Class="mt-3"/>

@if (Fbdata is null || order is null)
{
    <MudPaper Elevation="0" Style="background-color: #EEF0F2; min-height: 50vh;" Class="px-md-20 px-sm-10 px-xs-5 pb-5">
        <MudText Color=Color.Primary Typo="Typo.h2" Class="pt-10">Skills</MudText>
    </MudPaper>
    <MudPaper Elevation="0" Style="min-height: 50vh;" Class="px-md-20 px-sm-10 px-xs-5 pb-5">
        <MudText Color=Color.Primary Typo="Typo.h2" Class="pt-10">Experiences</MudText>
    </MudPaper>
}
else
{
    <AboutMe paragraphs="@Fbdata.AboutMe[aboutMeKey]"/>
    <Skills skillsDict="@Fbdata.Skills" keys="@skillKeys"/>

    <Experiences experienceDict="@Fbdata.Experiences" keys="@experienceKeys"/>

    <Projects projectDict="@Fbdata.Projects" keys="@projectKeys"/>
}

<Footer />

@* <MudScrollToTop>
    <MudFab Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowCircleUp" Size="Size.Small"/>
</MudScrollToTop> *@

@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "order")]
    public string? order { get; set; }

    private List<string> headers = ["About Me", "Skills", "Experience", "Projects"];

    public List<string>? skillKeys;
    public List<ExperienceKey>? experienceKeys;
    public List<ProjectKey>? projectKeys;
    public string? aboutMeKey;

    private FirebaseData? Fbdata;

    protected override async Task OnInitializedAsync()
    {
        Fbdata = await DbService.GetAllDataAsync<FirebaseData>();
        if (order is null)
        {
            order = "default";
        }
        @* Console.WriteLine(order); *@
        if (Fbdata is null)
        {
            Fbdata = await DbService.GetAllLocalDataAsync<FirebaseData>();
        }
        if (!Fbdata.Keys.ContainsKey(order))
        {
            order = "default";
        }

        if (Fbdata is not null)
        {
            aboutMeKey = Fbdata.Keys[order].AboutMeKey;
            skillKeys = Fbdata.Keys[order].SkillKeys;
            ExpandedStates.skillKeys = skillKeys;
            experienceKeys = Fbdata.Keys[order].ExperienceKeys;
            ExpandedStates.experienceKeys = experienceKeys;
            projectKeys = Fbdata.Keys[order].ProjectKeys;
            ExpandedStates.projectKeys = projectKeys;
        }
    }
}